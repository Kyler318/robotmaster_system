<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoboMaster æ¥µé€Ÿäº‚é¬¥ç®¡ç†ç³»çµ± v5.3</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, writeBatch, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // â˜…â˜…â˜… è«‹å°‡æ­¤è™•æ›¿æ›ç‚ºæ‚¨çš„ Firebase Config â˜…â˜…â˜…
        const firebaseConfig = {
            apiKey: "AIzaSyBdAMarLmul5OZgC_yIBs_pfkDvA2BWLFM",
            authDomain: "robomaster-competition.firebaseapp.com",
            projectId: "robomaster-competition",
            storageBucket: "robomaster-competition.firebasestorage.app",
            messagingSenderId: "681333907764",
            appId: "1:681333907764:web:f5fb267d6f7527a1348561"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentView = ref('schedule'); 
                const adminStage = ref('prelim'); 
                const newPlayerName = ref('');
                const newPlayerGroup = ref('A');
                const players = ref([]);
                const matches = ref([]);

                onMounted(() => {
                    onSnapshot(collection(db, "players"), (snapshot) => {
                        players.value = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    });
                    onSnapshot(collection(db, "matches"), (snapshot) => {
                        matches.value = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    });
                });

                // --- æ•¸æ“šæ“ä½œ ---
                const generateTestData = async () => {
                    if (!confirm("ç”Ÿæˆ60åæ¸¬è©¦é¸æ‰‹ï¼Ÿ")) return;
                    const batch = writeBatch(db);
                    for (let i = 1; i <= 32; i++) {
                        batch.set(doc(collection(db, "players")), { name: `Açµ„-${i}`, group: 'A', status: 'registered' });
                    }
                    for (let i = 1; i <= 28; i++) {
                        batch.set(doc(collection(db, "players")), { name: `Bçµ„-${i}`, group: 'B', status: 'registered' });
                    }
                    await batch.commit();
                };

                const addPlayer = async () => {
                    if (!newPlayerName.value) return;
                    await addDoc(collection(db, "players"), { name: newPlayerName.value, group: newPlayerGroup.value });
                    newPlayerName.value = '';
                    alert("æˆåŠŸ");
                };

                const editPlayer = async (p) => {
                    const newName = prompt(`ä¿®æ”¹é¸æ‰‹ ${p.name} çš„å§“åï¼š`, p.name);
                    if (newName && newName.trim() !== "" && newName !== p.name) {
                        try {
                            await updateDoc(doc(db, "players", p.id), { name: newName.trim() });
                        } catch (e) {
                            alert("ä¿®æ”¹å¤±æ•—ï¼š" + e.message);
                        }
                    }
                };

                const resetData = async () => {
                   if(!confirm("âš ï¸ ç¢ºå®šæ¸…ç©ºæ‰€æœ‰æ•¸æ“šï¼Ÿ")) return;
                   const pSnaps = await getDocs(collection(db, "players"));
                   pSnaps.forEach(d => deleteDoc(doc(db, "players", d.id)));
                   const mSnaps = await getDocs(collection(db, "matches"));
                   mSnaps.forEach(d => deleteDoc(doc(db, "matches", d.id)));
                };

                // --- è³½ç¨‹ç”Ÿæˆé‚è¼¯ ---
                const shuffle = (array) => array.sort(() => Math.random() - 0.5);

                // 1. åˆè³½ (å¢é‡ç”Ÿæˆ)
                const generatePrelims = async () => {
                    const activePlayerIds = new Set();
                    matches.value.forEach(m => m.players.forEach(p => activePlayerIds.add(p.id)));
                    
                    const unassignedA = players.value.filter(p => p.group === 'A' && !activePlayerIds.has(p.id));
                    const unassignedB = players.value.filter(p => p.group === 'B' && !activePlayerIds.has(p.id));

                    if (unassignedA.length === 0 && unassignedB.length === 0) return alert("ç„¡æ–°é¸æ‰‹");

                    const batch = writeBatch(db);
                    let count = 0;
                    
                    const makeMatch = (list, group, room) => {
                        const s = shuffle([...list]);
                        // A/Bçµ„åˆè³½ 4äººä¸€å±€
                        for (let i = 0; i < s.length; i += 4) {
                            const chunk = s.slice(i, i + 4);
                            batch.set(doc(collection(db, "matches")), {
                                round: 'prelim', group, players: chunk, room, winnerId: null, createdAt: Date.now()
                            });
                            count++;
                        }
                    };
                    // Bçµ„æ”¹ç‚º Room 8
                    makeMatch(unassignedA, 'A', 'Room 7');
                    makeMatch(unassignedB, 'B', 'Room 8');

                    await batch.commit();
                    alert(`æ–°å¢ ${count} å ´åˆè³½`);
                };

                // 2. åŠæ±ºè³½ (å‹•æ…‹åˆ†é… + åˆä½µè‡³ Room 7)
                const generateSemis = async () => {
                    const activeSemiIds = new Set();
                    matches.value.filter(m => m.round === 'semi').forEach(m => {
                        m.players.forEach(p => activeSemiIds.add(p.id));
                    });

                    // ç²å–æ™‰ç´šè€…
                    const waitingList = matches.value
                        .filter(m => m.round === 'prelim' && m.winnerId)
                        .map(m => m.players.find(p => p.id === m.winnerId))
                        .filter(p => p && !activeSemiIds.has(p.id));

                    const n = waitingList.length;
                    if (n < 2) {
                        return alert(`ç›®å‰åªæœ‰ ${n} ä½æ™‰ç´šè€…å¾…å‘½ï¼Œç„¡æ³•é–‹å±€ã€‚`);
                    }

                    // --- åˆ†é…é‚è¼¯ ---
                    let distribution = [];
                    
                    if (n === 8) {
                        distribution = [2, 2, 2, 2]; // 4å±€
                    } else if (n === 9) {
                        distribution = [2, 2, 2, 3]; // 4å±€
                    } else if (n === 10) {
                        distribution = [3, 3, 4];    // 3å±€
                    } else if (n === 11) {
                        distribution = [3, 3, 3, 2]; // 4å±€
                    } else {
                        // é€šç”¨é‚è¼¯
                        let targetGroups = 4; 
                        if (n < 6) targetGroups = 2;
                        else if (n < 8) targetGroups = 3;
                        else if (n > 16) targetGroups = 5;

                        const baseSize = Math.floor(n / targetGroups);
                        const remainder = n % targetGroups;
                        
                        for (let i = 0; i < targetGroups; i++) {
                            distribution.push(baseSize + (i < remainder ? 1 : 0));
                        }
                    }

                    // --- åŸ·è¡Œç”Ÿæˆ ---
                    const batch = writeBatch(db);
                    const s = shuffle([...waitingList]);
                    let startIndex = 0;
                    
                    distribution.forEach((size, idx) => {
                        const chunk = s.slice(startIndex, startIndex + size);
                        startIndex += size;
                        
                        batch.set(doc(collection(db, "matches")), {
                            round: 'semi', 
                            group: `S${idx + 1}`,
                            players: chunk, 
                            room: 'Room 7', // å…¨éƒ¨åˆä½µåˆ° Room 7
                            winnerId: null, 
                            createdAt: Date.now()
                        });
                    });

                    await batch.commit();
                    alert(`å·²ç”ŸæˆåŠæ±ºè³½ (${n}äºº)ï¼šåˆ†é…ç‚º [${distribution.join(', ')}]ï¼Œå…¨éƒ¨åœ¨ Room 7`);
                };

                // 3. æ±ºè³½
                const generateFinal = async () => {
                    if(matches.value.some(m => m.round === 'final')) {
                        if(!confirm("æ±ºè³½å·²å­˜åœ¨ï¼Œç¢ºå®šè¦é‡æ–°ç”Ÿæˆå—ï¼Ÿ")) return;
                    }
                    const winners = matches.value
                        .filter(m => m.round === 'semi' && m.winnerId)
                        .map(m => m.players.find(p => p.id === m.winnerId));
                    
                    if (winners.length === 0) return alert("ç„¡åŠæ±ºè³½æ™‰ç´šè€…");

                    await addDoc(collection(db, "matches"), {
                        round: 'final', group: 'Final', players: winners, room: 'Main Stage',
                        ranks: [] 
                    });
                    alert(`æ±ºè³½ç”Ÿæˆ (å…± ${winners.length} äºº)`);
                };

                // --- è£åˆ¤åˆ¤å®šé‚è¼¯ ---
                const setWinner = async (match, winnerId) => {
                    const winnerName = match.players.find(p => p.id === winnerId).name;
                    if (match.winnerId) {
                        if (match.winnerId === winnerId) return;
                        if(!confirm(`âš ï¸ ç¢ºå®šè¦å°‡ç²å‹è€…æ›´æ”¹ç‚ºã€${winnerName}ã€‘å—ï¼Ÿ`)) return;
                    } else {
                        if(!confirm(`ç¢ºèªã€${winnerName}ã€‘ç²å‹ï¼Ÿ`)) return;
                    }
                    await updateDoc(doc(db, "matches", match.id), { winnerId });
                };

                const toggleFinalRank = async (match, playerId) => {
                    let currentRanks = match.ranks || [];
                    if (currentRanks.includes(playerId)) {
                        currentRanks = currentRanks.filter(id => id !== playerId);
                    } else {
                        if (currentRanks.length < 3) {
                            currentRanks.push(playerId);
                        } else {
                            alert("å‰ä¸‰åå·²æ»¿ï¼è«‹å…ˆå–æ¶ˆä¸€ä½ï¼Œå†é‡æ–°é¸æ“‡ã€‚");
                            return;
                        }
                    }
                    await updateDoc(doc(db, "matches", match.id), { ranks: currentRanks });
                };

                const getRankDisplay = (match, playerId) => {
                    if (!match.ranks) return null;
                    const index = match.ranks.indexOf(playerId);
                    if (index === 0) return { label: 'ğŸ¥‡ å† è»', color: 'bg-yellow-400 text-yellow-900 border-yellow-600' };
                    if (index === 1) return { label: 'ğŸ¥ˆ äºè»', color: 'bg-gray-300 text-gray-800 border-gray-500' };
                    if (index === 2) return { label: 'ğŸ¥‰ å­£è»', color: 'bg-orange-300 text-orange-900 border-orange-600' };
                    return null;
                };

                const prelimMatches = computed(() => matches.value.filter(m => m.round === 'prelim').sort((a,b)=>a.createdAt - b.createdAt));
                const semiMatches = computed(() => matches.value.filter(m => m.round === 'semi').sort((a,b)=>a.createdAt - b.createdAt));
                const finalMatches = computed(() => matches.value.filter(m => m.round === 'final'));

                return {
                    currentView, adminStage, newPlayerName, newPlayerGroup, players,
                    addPlayer, editPlayer, generateTestData, resetData,
                    generatePrelims, generateSemis, generateFinal,
                    prelimMatches, semiMatches, finalMatches,
                    setWinner, toggleFinalRank, getRankDisplay
                };
            }
        }).mount('#app');
    </script>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800">
    <div id="app" class="max-w-6xl mx-auto bg-white shadow-2xl min-h-screen flex flex-col">
        
        <nav class="flex text-lg font-bold text-white bg-slate-900 sticky top-0 z-50 shadow-md">
            <button @click="currentView='schedule'" :class="currentView=='schedule'?'bg-blue-600':'hover:bg-slate-700'" class="flex-1 py-4 transition flex flex-col items-center">
                <span>ğŸ“Š</span><span class="text-sm">è§€çœ¾è³½ç¨‹</span>
            </button>
            <button @click="currentView='checkin'" :class="currentView=='checkin'?'bg-blue-600':'hover:bg-slate-700'" class="flex-1 py-4 transition flex flex-col items-center">
                <span>ğŸ“</span><span class="text-sm">æª¢éŒ„è™•</span>
            </button>
            <button @click="currentView='admin'" :class="currentView=='admin'?'bg-blue-600':'hover:bg-slate-700'" class="flex-1 py-4 transition flex flex-col items-center">
                <span>âš–ï¸</span><span class="text-sm">è£åˆ¤æ§å°</span>
            </button>
        </nav>

        <main class="p-4 md:p-6 flex-1">
            
            <div v-if="currentView === 'checkin'" class="space-y-6 max-w-3xl mx-auto">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded shadow-sm">
                    <h2 class="text-xl font-bold mb-4">é¸æ‰‹å ±å</h2>
                    <div class="flex gap-2">
                        <input v-model="newPlayerName" @keyup.enter="addPlayer" type="text" placeholder="è¼¸å…¥å§“å..." class="border-2 p-2 flex-1 rounded focus:border-blue-500 outline-none">
                        <select v-model="newPlayerGroup" class="border-2 p-2 rounded w-24">
                            <option value="A">Açµ„</option>
                            <option value="B">Bçµ„</option>
                        </select>
                        <button @click="addPlayer" class="bg-blue-600 text-white px-6 rounded font-bold hover:bg-blue-700">æ·»åŠ </button>
                    </div>
                </div>
                <div class="text-right">
                    <button @click="generateTestData" class="text-xs text-gray-400 hover:text-gray-600 underline">æ¸¬è©¦æŒ‰éˆ•ï¼šç”Ÿæˆ60äºº</button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded border h-[60vh] flex flex-col">
                        <h3 class="font-bold text-blue-800 mb-2">Açµ„ ({{ players.filter(p=>p.group=='A').length }})</h3>
                        <div class="flex-1 overflow-y-auto text-sm space-y-1 pr-1">
                            <div v-for="p in players.filter(p=>p.group=='A')" :key="p.id" class="px-2 py-1 bg-white rounded shadow-sm flex justify-between items-center group">
                                <span>{{ p.name }}</span>
                                <button @click="editPlayer(p)" class="text-xs text-blue-400 hover:text-blue-700 opacity-0 group-hover:opacity-100 transition px-1">âœï¸</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded border h-[60vh] flex flex-col">
                        <h3 class="font-bold text-green-800 mb-2">Bçµ„ ({{ players.filter(p=>p.group=='B').length }})</h3>
                        <div class="flex-1 overflow-y-auto text-sm space-y-1 pr-1">
                            <div v-for="p in players.filter(p=>p.group=='B')" :key="p.id" class="px-2 py-1 bg-white rounded shadow-sm flex justify-between items-center group">
                                <span>{{ p.name }}</span>
                                <button @click="editPlayer(p)" class="text-xs text-green-400 hover:text-green-700 opacity-0 group-hover:opacity-100 transition px-1">âœï¸</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <div v-if="currentView === 'admin'">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">è³½ç¨‹æ§åˆ¶ä¸­å¿ƒ</h2>
                    <button @click="resetData" class="text-red-500 text-sm border border-red-200 px-3 py-1 rounded hover:bg-red-50">é‡ç½®ç³»çµ±</button>
                </div>

                <div class="flex border-b-2 border-gray-100 mb-6 sticky top-0 bg-white z-10 pt-2">
                    <button v-for="s in ['prelim', 'semi', 'final']" @click="adminStage=s" 
                        class="flex-1 px-4 py-3 font-bold transition capitalize text-center"
                        :class="adminStage===s ? 'text-blue-600 border-b-4 border-blue-600 bg-blue-50' : 'text-gray-400 hover:text-gray-600'">
                        {{ s === 'prelim' ? '1. åˆè³½' : (s === 'semi' ? '2. åŠæ±ºè³½' : '3. æ±ºè³½') }}
                    </button>
                </div>

                <div v-if="adminStage === 'prelim'" class="space-y-4">
                    <div class="bg-purple-50 p-4 rounded border border-purple-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-purple-900">åˆè³½æ’ç¨‹å™¨</h3>
                            <button @click="generatePrelims" class="bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 shadow text-sm">æ›´æ–°è³½ç¨‹ (åŠ å…¥æ–°é¸æ‰‹)</button>
                        </div>
                        <p class="text-xs text-purple-600">ç³»çµ±æœƒè‡ªå‹•åµæ¸¬æ–°å ±åˆ°çš„é¸æ‰‹ä¸¦å®‰æ’æ–°å ´æ¬¡ã€‚</p>
                    </div>
                    
                    <div class="grid lg:grid-cols-2 gap-4">
                        <div v-for="m in prelimMatches" :key="m.id" class="bg-white p-3 rounded border shadow-sm">
                            <div class="flex justify-between text-xs font-bold text-gray-500 mb-2">
                                <span class="px-2 py-0.5 text-white rounded" :class="m.group=='A'?'bg-blue-400':'bg-green-400'">{{m.group}}çµ„</span>
                                <span>{{m.room}}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button v-for="p in m.players" @click="setWinner(m, p.id)"
                                    class="py-2 text-sm border rounded transition relative overflow-hidden"
                                    :class="m.winnerId===p.id?'bg-green-500 text-white font-bold ring-2 ring-green-300':'hover:bg-gray-50 bg-gray-50'">
                                    {{ p.name }}
                                    <div v-if="m.winnerId===p.id" class="absolute right-1 top-1 text-xs">ğŸ†</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="adminStage === 'semi'" class="space-y-4">
                     <div class="bg-indigo-50 p-4 rounded border border-indigo-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-indigo-900">åŠæ±ºè³½æ’ç¨‹å™¨</h3>
                            <button @click="generateSemis" class="bg-indigo-600 text-white px-4 py-2 rounded font-bold hover:bg-indigo-700 shadow text-sm">æª¢æŸ¥ä¸¦ç”Ÿæˆæ–°è³½ç¨‹</button>
                        </div>
                        <p class="text-xs text-indigo-600">æ ¹æ“šäººæ•¸è‡ªå‹•åˆ†é…ï¼Œå…¨éƒ¨åˆä½µè‡³ Room 7ã€‚</p>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-4">
                        <div v-for="m in semiMatches" :key="m.id" class="bg-white p-3 rounded border shadow-sm">
                            <div class="flex justify-between text-xs font-bold text-gray-500 mb-2">
                                <span class="bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded">åŠæ±ºè³½ ({{ m.players.length }}äºº)</span>
                                <span>{{m.room}}</span>
                            </div>
                            <div class="flex gap-2">
                                <button v-for="p in m.players" @click="setWinner(m, p.id)"
                                    class="flex-1 py-3 text-sm border rounded transition relative"
                                    :class="m.winnerId===p.id?'bg-green-500 text-white font-bold':'hover:bg-gray-50 bg-gray-50'">
                                    {{ p.name }}
                                    <span v-if="m.winnerId===p.id" class="absolute top-0 right-1 text-xs">ğŸ†</span>
                                </button>
                            </div>
                        </div>
                         <p v-if="semiMatches.length === 0" class="text-center text-gray-400 py-10 col-span-2">å°šç„¡åŠæ±ºè³½è³½ç¨‹</p>
                    </div>
                </div>

                <div v-if="adminStage === 'final'" class="space-y-6">
                    <button @click="generateFinal" class="w-full py-3 bg-yellow-600 text-white rounded font-bold hover:bg-yellow-700 shadow">ç”Ÿæˆæ±ºè³½åå–® (ç›®æ¨™4äºº)</button>
                    
                    <div v-for="m in finalMatches" :key="m.id" class="bg-white border-4 border-yellow-200 p-6 rounded-xl shadow-lg">
                        <h3 class="text-center font-bold text-xl text-yellow-800 mb-2">ğŸ† æ±ºè³½æ’å</h3>
                        <p class="text-center text-gray-500 text-sm mb-6">é»æ“Šé †åºï¼š1.å† è» -> 2.äºè» -> 3.å­£è» (å†æ¬¡é»æ“Šå¯å–æ¶ˆ)</p>
                        <div class="flex flex-wrap justify-center gap-4">
                            <button v-for="p in m.players" :key="p.id" @click="toggleFinalRank(m, p.id)"
                                class="w-28 h-28 flex flex-col items-center justify-center rounded-xl border-2 transition transform hover:scale-105"
                                :class="getRankDisplay(m, p.id) ? getRankDisplay(m, p.id).color + ' ring-4 ring-opacity-50' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'">
                                <span class="text-2xl mb-1">{{ getRankDisplay(m, p.id) ? getRankDisplay(m, p.id).label.split(' ')[0] : 'ğŸ‘¤' }}</span>
                                <span class="font-bold text-sm leading-tight text-center px-1 break-words w-full">{{ p.name }}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'schedule'" class="space-y-10 pb-10">
                
                <div v-if="finalMatches.length > 0" class="animate-fade-in-down">
                    <div class="text-center mb-6">
                         <span class="bg-yellow-500 text-white px-4 py-1 rounded-full text-sm font-bold tracking-widest shadow">FINAL STAGE</span>
                    </div>
                    <div v-for="m in finalMatches" class="flex justify-center items-end gap-2 md:gap-4 text-center max-w-2xl mx-auto">
                        <div class="w-1/3 flex flex-col items-center">
                            <div class="text-gray-600 font-bold text-sm md:text-lg mb-1 truncate w-full">{{ m.ranks && m.ranks[1] ? m.players.find(p=>p.id===m.ranks[1]).name : '???' }}</div>
                            <div class="w-full h-24 md:h-32 bg-gray-300 rounded-t-lg flex items-center justify-center text-3xl shadow-lg border-t-4 border-gray-400">ğŸ¥ˆ</div>
                        </div>
                        <div class="w-1/3 flex flex-col items-center -mb-2 z-10">
                            <div class="text-yellow-600 font-black text-lg md:text-2xl mb-2 truncate w-full transform -translate-y-2">{{ m.ranks && m.ranks[0] ? m.players.find(p=>p.id===m.ranks[0]).name : '???' }}</div>
                            <div class="w-full h-32 md:h-40 bg-yellow-400 rounded-t-lg flex items-center justify-center text-5xl shadow-xl border-t-4 border-yellow-200 ring-4 ring-yellow-100">ğŸ¥‡</div>
                        </div>
                        <div class="w-1/3 flex flex-col items-center">
                            <div class="text-orange-700 font-bold text-sm md:text-lg mb-1 truncate w-full">{{ m.ranks && m.ranks[2] ? m.players.find(p=>p.id===m.ranks[2]).name : '???' }}</div>
                            <div class="w-full h-20 md:h-24 bg-orange-300 rounded-t-lg flex items-center justify-center text-3xl shadow-lg border-t-4 border-orange-400">ğŸ¥‰</div>
                        </div>
                    </div>
                </div>

                <div v-if="semiMatches.length > 0">
                    <h3 class="text-center text-xl font-bold text-indigo-800 mb-4 flex items-center justify-center gap-2">
                        <span class="block w-8 h-1 bg-indigo-200 rounded"></span> åŠæ±ºè³½ <span class="block w-8 h-1 bg-indigo-200 rounded"></span>
                    </h3>
                    <div class="grid md:grid-cols-2 gap-3 px-2">
                        <div v-for="m in semiMatches" class="bg-white p-3 rounded shadow-sm border-l-4 border-indigo-500">
                            <div class="flex justify-between mb-2">
                                <span class="text-xs text-indigo-400 font-bold">{{ m.room }}</span>
                                <span class="text-xs text-gray-400">{{ m.group }}</span>
                            </div>
                            <div class="space-y-1">
                                <div v-for="p in m.players" class="flex justify-between items-center p-1.5 rounded text-sm" 
                                    :class="m.winnerId===p.id?'bg-indigo-600 text-white font-bold shadow-md transform scale-105':'bg-gray-50'">
                                    <span>{{ p.name }}</span>
                                    <span v-if="m.winnerId===p.id" class="text-xs bg-white text-indigo-600 px-2 rounded">æ™‰ç´š</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="prelimMatches.length > 0">
                    <h3 class="text-center text-xl font-bold text-gray-600 mb-4">åˆè³½ç¸½è¦½</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 px-2">
                        <div v-for="m in prelimMatches" class="bg-white p-2 rounded border border-gray-200 text-xs">
                             <div class="flex justify-between mb-1 text-gray-400">
                                <span :class="m.group=='A'?'text-blue-500':'text-green-500'">{{m.group}}çµ„</span>
                                <span>{{ m.room.split(' ')[1] }}</span>
                            </div>
                            <div class="space-y-1">
                                <div v-for="p in m.players" class="flex justify-between" :class="m.winnerId===p.id?'text-green-600 font-bold':''">
                                    <span class="truncate">{{ p.name }}</span>
                                    <span v-if="m.winnerId===p.id">âœ…</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>
</body>
</html>